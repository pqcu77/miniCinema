# MiniCinema 前后端联调测试指南

## 📋 项目完成情况

✅ **前端部分（完整）**
- 独立的 `frontend` 文件夹
- 6个完整的HTML页面（首页、登录、注册、电影列表、电影详情、个人中心）
- 完整的API调用层 (`js/api.js`)
- 工具函数和状态管理 (`js/utils.js`)
- 各页面的逻辑文件（`js/pages/`）
- 统一的样式表 (`css/style.css`)

✅ **后端部分（已有）**
- 用户登录/注册接口
- 用户管理接口
- 基础的异常处理和结果返回

---

## 🚀 快速开始

### 第一步：启动后端服务

1. **确保数据库配置正确**
   - 打开 `src/main/resources/application.yml`
   - 检查数据库连接配置

2. **启动 Spring Boot 应用**
   ```powershell
   # 在项目根目录执行
   mvn spring-boot:run
   # 或者直接在IDE中运行 MiniCinemaApplication.java
   ```

3. **验证后端启动成功**
   - 后端应该运行在 `http://localhost:8080`
   - 在控制台看到 "Started MiniCinemaApplication" 信息

### 第二步：启动前端服务

**方法1：使用 Live Server（推荐）**
```powershell
# 安装 Live Server（如果未安装）
npm install -g live-server

# 在 frontend 文件夹启动
cd frontend
live-server
```
前端会自动打开在 `http://127.0.0.1:8080` 或 `http://localhost:5500`

**方法2：直接打开 HTML 文件**
- 在 `frontend` 文件夹中找到 `index.html`
- 右键选择 "用浏览器打开" 或双击打开
- 注意：直接打开可能有跨域问题，建议使用 Live Server

**方法3：使用 Python 简单服务器**
```powershell
cd frontend
python -m http.server 8000
# 或 Python 2：python -m SimpleHTTPServer 8000
```

### 第三步：开始测试

访问前端页面（取决于你选择的启动方式）：
```
http://localhost:5500  # Live Server
或
http://localhost:8000  # Python 服务器
或
file:///D:/Desktop/Junior/DB_proj/MiniCinema/frontend/index.html  # 直接打开
```

---

## 🧪 完整的测试流程

### 1️⃣ 测试注册功能

**测试用例**
```
访问: http://localhost:5500/register.html

输入测试数据:
- 用户名: testuser123
- 邮箱: test@example.com
- 密码: password123
- 确认密码: password123

期望结果:
✓ 注册成功，显示"注册成功，跳转到登录页..."消息
✓ 2秒后自动跳转到登录页面
```

**如果出现问题**
```
问题1: "网络错误，请重试"
- 检查后端是否启动在 http://localhost:8080
- 检查浏览器控制台的 CORS 错误

问题2: "用户名已存在"
- 说明注册接口正常工作，更换用户名重试

问题3: "邮箱已存在"
- 说明注册接口正常工作，更换邮箱重试
```

### 2️⃣ 测试登录功能

**测试用例**
```
访问: http://localhost:5500/login.html

输入测试数据:
- 用户名: testuser123
- 密码: password123

期望结果:
✓ 登录成功，显示"登录成功！"消息
✓ token 保存在浏览器 localStorage
✓ 用户信息保存到 localStorage
✓ 2秒后自动跳转到电影列表页面
```

**验证存储**
```javascript
// 打开浏览器控制台 (F12)，运行以下代码验证登录数据
console.log('Token:', localStorage.getItem('token'));
console.log('User:', JSON.parse(localStorage.getItem('user')));
```

### 3️⃣ 测试电影列表功能

**测试用例**
```
访问: http://localhost:5500/movies.html

期望结果:
✓ 自动加载电影列表（如果数据库中有电影）
✓ 显示分页按钮
✓ 可以切换页码
✓ 搜索框可用
✓ 点击电影卡片可以进入详情页
✓ 右上角显示 "欢迎, testuser123" 和 "个人中心" 链接
```

**如果列表为空**
```
可能原因：数据库中没有电影数据
解决：
1. 需要先往数据库插入电影数据
2. 或者后端提供的电影列表接口未实现

测试方法：
- 打开浏览器控制台，查看 Network 标签
- 检查 GET http://localhost:8080/movie/list?page=1&pageSize=10
- 查看响应是否正确返回数据
```

### 4️⃣ 测试电影详情和收藏

**测试用例**
```
从电影列表点击任意电影 → 进入详情页

期望结果:
✓ 显示电影海报、标题、导演、演员等信息
✓ 显示 "购票" 和 "+ 收藏" 按钮
✓ 点击 "+ 收藏" 按钮，按钮变为 "✓ 已收藏"
✓ 刷新页面后，按钮仍显示 "✓ 已收藏"（说明收藏数据已保存）
```

### 5️⃣ 测试个人中心

**访问个人中心**
```
点击右上角的 "个人中心" → 进入个人中心页面

期望结果:
✓ 显示用户名（不可编辑）
✓ 显示邮箱（可编辑）
✓ 可以修改邮箱并保存
```

**修改密码**
```
点击 "修改密码" 标签页

输入:
- 原密码: password123
- 新密码: newpassword123
- 确认密码: newpassword123

期望结果:
✓ 修改成功，显示"密码修改成功"消息
✓ 自动退出登录，跳转到登录页
✓ 用新密码登录成功
```

**查看收藏**
```
点击 "我的收藏" 标签页

期望结果:
✓ 显示你之前收藏的电影
✓ 点击电影卡片可以进入详情页
✓ 如果没有收藏，显示 "还没有收藏电影"
```

### 6️⃣ 测试退出登录

```
点击右上角的 "退出登录" 按钮

期望结果:
✓ 清空 localStorage 中的 token 和用户信息
✓ 自动跳转到登录页
✓ 右上角变回 "登录" 和 "注册" 链接
```

---

## 🔍 调试和问题排查

### 查看浏览器控制台（F12）

**Network 标签：检查网络请求**
```
1. 打开 Network 标签
2. 执行某个操作（如登录）
3. 查看请求的 URL、状态码、响应内容
4. 常见错误码：
   - 404: 后端接口不存在
   - 500: 后端服务器错误
   - CORS 错误: 跨域问题
```

**Console 标签：查看错误信息**
```
1. 打开 Console 标签
2. 执行任何操作时，错误信息会显示这里
3. 查看具体的错误堆栈，帮助定位问题
```

### 常见 CORS 跨域问题

**错误现象**
```
跨域请求被阻止，控制台看到：
Access to XMLHttpRequest at 'http://localhost:8080/user/login' 
from origin 'http://localhost:5500' has been blocked by CORS policy
```

**解决方案**
我会为后端添加 CORS 配置。请检查是否已经添加了 CORS 配置文件。

---

## 📊 API 测试清单

| 功能 | 方法 | URL | 状态 |
|-----|------|-----|------|
| 登录 | POST | /user/login | ✓ 完成 |
| 注册 | POST | /user/register | ✓ 完成 |
| 修改用户信息 | PUT | /user/update | ❓ 需验证 |
| 修改密码 | POST | /user/changePassword | ❓ 需验证 |
| 退出登录 | POST | /user/logout | ❓ 需验证 |
| 获取电影列表 | GET | /movie/list | ❓ 需后端实现 |
| 获取电影详情 | GET | /movie/{id} | ❓ 需后端实现 |
| 搜索电影 | GET | /movie/search | ❓ 需后端实现 |
| 添加收藏 | POST | /favorite/add | ❓ 需后端实现 |
| 删除收藏 | DELETE | /favorite/remove/{id} | ❓ 需后端实现 |
| 获取收藏列表 | GET | /favorite/list | ❓ 需后端实现 |

---

## 🛠️ 后续需要实现的后端接口

根据前端需求，你还需要在后端实现以下接口：

### 1. 电影管理接口（MovieController）
```java
@GetMapping("/list")
public Result<PageVO<MovieDTO>> getMovieList(@RequestParam int page, @RequestParam int pageSize)

@GetMapping("/{id}")
public Result<MovieDTO> getMovieDetail(@PathVariable Integer id)

@GetMapping("/search")
public Result<List<MovieDTO>> searchMovies(@RequestParam String keyword)
```

### 2. 收藏管理接口（FavoriteController）
```java
@PostMapping("/add")
public Result<Void> addFavorite(@RequestBody FavoriteDTO dto, @RequestHeader String Authorization)

@DeleteMapping("/remove/{movieId}")
public Result<Void> removeFavorite(@PathVariable Integer movieId, @RequestHeader String Authorization)

@GetMapping("/list")
public Result<List<FavoriteDTO>> getFavorites(@RequestHeader String Authorization)
```

### 3. 用户信息更新接口（已有但需验证）
```java
@PutMapping("/update")
public Result<UserDTO> updateUser(@RequestBody UpdateUserDTO dto, @RequestHeader String Authorization)

@PostMapping("/changePassword")
public Result<Void> changePassword(@RequestBody ChangePasswordDTO dto, @RequestHeader String Authorization)

@PostMapping("/logout")
public Result<Void> logout(@RequestHeader String Authorization)
```

---

## 📝 使用 Postman 测试 API

如果需要更全面的测试，可以使用 Postman：

1. **下载安装 Postman**：https://www.postman.com/downloads/

2. **创建请求测试登录**
   ```
   方法: POST
   URL: http://localhost:8080/user/login
   Headers: Content-Type: application/json
   Body (JSON):
   {
     "username": "testuser",
     "password": "password123"
   }
   ```

3. **测试注册**
   ```
   方法: POST
   URL: http://localhost:8080/user/register
   Headers: Content-Type: application/json
   Body (JSON):
   {
     "username": "newuser",
     "password": "password123",
     "confirmPassword": "password123",
     "email": "user@example.com"
   }
   ```

---

## 💡 完整测试时间表

```
第1步 (5分钟)：启动后端，验证数据库连接
         ↓
第2步 (2分钟)：启动前端 Live Server
         ↓
第3步 (10分钟)：测试注册功能
         ↓
第4步 (5分钟)：测试登录功能
         ↓
第5步 (10分钟)：测试电影列表和搜索
         ↓
第6步 (10分钟)：测试电影详情和收藏
         ↓
第7步 (5分钟)：测试个人中心
         ↓
第8步 (5分钟)：测试退出登录
```

总计：约 50 分钟完成全流程测试

---

## ✅ 验证清单

测试完成后，检查以下项目：

- [ ] 注册功能正常
- [ ] 登录功能正常
- [ ] Token 正确保存到 localStorage
- [ ] 电影列表加载正常（前提：数据库有数据）
- [ ] 电影搜索功能正常
- [ ] 电影详情显示正确
- [ ] 收藏功能正常
- [ ] 个人中心信息显示正确
- [ ] 修改邮箱功能正常
- [ ] 修改密码功能正常
- [ ] 退出登录功能正常
- [ ] 浏览器控制台没有关键错误信息

---

如有任何问题，请查看浏览器控制台的错误信息，或提供具体的错误描述！

